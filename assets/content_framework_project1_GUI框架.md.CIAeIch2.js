import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.C78-raJP.js";const h="/framework/project.png",y=JSON.parse('{"title":"ä½¿ç”¨ Swift æ„å»ºè‡ªå®šä¹‰ GUI æ¡†æ¶","description":"","frontmatter":{},"headers":[],"relativePath":"content/framework/project1/GUIæ¡†æ¶.md","filePath":"content/framework/project1/GUIæ¡†æ¶.md","lastUpdated":null}'),k={name:"content/framework/project1/GUIæ¡†æ¶.md"};function t(p,s,e,E,r,d){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="ä½¿ç”¨-swift-æ„å»ºè‡ªå®šä¹‰-gui-æ¡†æ¶" tabindex="-1">ä½¿ç”¨ Swift æ„å»ºè‡ªå®šä¹‰ GUI æ¡†æ¶ <a class="header-anchor" href="#ä½¿ç”¨-swift-æ„å»ºè‡ªå®šä¹‰-gui-æ¡†æ¶" aria-label="Permalink to &quot;ä½¿ç”¨ Swift æ„å»ºè‡ªå®šä¹‰ GUI æ¡†æ¶&quot;">â€‹</a></h1><p>è¿™ä¸ªé¡¹ç›®è®¡åˆ’å®ç°ä¸€ä¸ªåŸºäºåŒå±‚äº‹ä»¶/çŠ¶æ€ç³»ç»Ÿï¼ˆEventBus + å“åº”å¼çŠ¶æ€ï¼‰ä¸”å¯Œæœ‰è¡¨ç°åŠ›çš„è‡ªå®šä¹‰GUIæ¡†æ¶ã€‚</p><h2 id="æ ¸å¿ƒç»„ä»¶" tabindex="-1">æ ¸å¿ƒç»„ä»¶ <a class="header-anchor" href="#æ ¸å¿ƒç»„ä»¶" aria-label="Permalink to &quot;æ ¸å¿ƒç»„ä»¶&quot;">â€‹</a></h2><ul><li><p><strong>è¯­è¨€</strong>: Swift CPP C</p></li><li><p><strong>æ¸²æŸ“å¼•æ“</strong>: Skia (é€šè¿‡ CPP extern C API å†å¯¼å…¥ Swiftï¼Œè´Ÿè´£æ‰€æœ‰å›¾å½¢ç»˜åˆ¶)</p></li><li><p><strong>å¸ƒå±€å¼•æ“</strong>: Yoga (Facebook çš„ Flexbox Swift å®ç°ï¼Œè´Ÿè´£UIå…ƒç´ å¸ƒå±€)</p></li><li><p><strong>å¹³å°é›†æˆ</strong>: Win32 API (çº¯C API,ç”¨äºåœ¨ Windows ä¸Šåˆ›å»ºçª—å£ã€å¤„ç†ç³»ç»Ÿäº‹ä»¶)</p></li><li><p><strong>äº‹ä»¶ç³»ç»Ÿ</strong>: äº‹ä»¶æ€»çº¿æœºåˆ¶ (çº¯Swift)</p></li><li><p><strong>UIç»„ä»¶</strong>: å‚çœ‹ Fluent-react (è‡ªå·±è®¾è®¡ä¸å‡ºUE UX é‚£å°±ç›´æ¥æŠ„ä½œä¸š)</p></li><li><p><strong>å“åº”å¼</strong>: æ•°æ®ä¸ç»„ä»¶åŒå‘ç»‘å®š ( å‚è€ƒ react vue swiftui )</p></li><li><p><strong>åŠ¨ç”»</strong>:åŸºäºç‰©ç†å¼¹ç°§æ¨¡å‹çš„åŠ¨ç”».ä¸æ˜¯åŸºäºå®šæ—¶å™¨! ä¸æ˜¯åŸºäºå®šæ—¶å™¨! ä¸æ˜¯åŸºäºå®šæ—¶å™¨! è¿™ç§æ–¹å¼å®ç°çš„åŠ¨ç”»æ„Ÿè§‰æ›´â€œæ´»â€ï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶æ”¹å˜ç›®æ ‡å€¼ï¼ŒåŠ¨ç”»ä¼šè‡ªç„¶åœ°è¿‡æ¸¡åˆ°æ–°çš„ç›®æ ‡ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†çŠ¶æ€ã€‚</p></li><li><p><strong>DSL</strong>: ä¾¿æ·çš„ä½¿ç”¨ç»„ä»¶( å‚è€ƒSwiftUI,æˆ–è€…ç›´æ¥ä½¿ç”¨ä¸€æ ·çš„DSL ä»¥åè¦åšè·¨å¹³å°ç›´æ¥æ¥å…¥SwiftUI )</p><ul><li><div class="language-swift vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// import SwiftGui</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SwiftUI</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æ¢ä¸ªå¯¼å…¥å°±OK ä¸€è¡Œä»£ç ä¸ç”¨åŠ¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myUI </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, Declarative UI!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This is awesome.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    VStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nested Stack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ul></li></ul><h2 id="æ¨èä¹¦ç±ä¸èµ„æº" tabindex="-1">æ¨èä¹¦ç±ä¸èµ„æº <a class="header-anchor" href="#æ¨èä¹¦ç±ä¸èµ„æº" aria-label="Permalink to &quot;æ¨èä¹¦ç±ä¸èµ„æº&quot;">â€‹</a></h2><h3 id="_1-ã€Šwindows-ç¨‹åºè®¾è®¡-ç¬¬5ç‰ˆã€‹" tabindex="-1">1. ã€ŠWindows ç¨‹åºè®¾è®¡ ç¬¬5ç‰ˆã€‹ <a class="header-anchor" href="#_1-ã€Šwindows-ç¨‹åºè®¾è®¡-ç¬¬5ç‰ˆã€‹" aria-label="Permalink to &quot;1. ã€ŠWindows ç¨‹åºè®¾è®¡ ç¬¬5ç‰ˆã€‹&quot;">â€‹</a></h3><ul><li><strong>ç”¨é€”</strong>: <strong>å¹³å°é›†æˆå±‚</strong>ã€‚è§£å†³â€œå¦‚ä½•è®©ç¨‹åºåœ¨ Windows ä¸Šè¿è¡Œâ€çš„é—®é¢˜ã€‚</li><li><strong>å­¦ä¹ å†…å®¹</strong>: <ul><li>ä½¿ç”¨ Win32 API åˆ›å»ºå’Œç®¡ç†çª—å£ (<code>CreateWindowEx</code>)ã€‚</li><li>å»ºç«‹å’Œç®¡ç†æ¶ˆæ¯å¾ªç¯ (<code>GetMessage</code>)ï¼Œå¤„ç†æ“ä½œç³»ç»Ÿäº‹ä»¶ã€‚</li><li>å°† Skia çš„æ¸²æŸ“è¡¨é¢é™„åŠ åˆ°çª—å£å¥æŸ„ (<code>HWND</code>) ä¸Šã€‚</li></ul></li><li><strong>é‡è¦æ€§</strong>: <strong>å¿…éœ€</strong>ã€‚è¿™æ˜¯ä½ çš„æ¡†æ¶ä¸ Windows æ“ä½œç³»ç»Ÿäº¤äº’çš„æ¡¥æ¢ã€‚</li></ul><h3 id="_2-ã€Šæ¸¸æˆç¼–ç¨‹æ¨¡å¼ã€‹" tabindex="-1">2. ã€Šæ¸¸æˆç¼–ç¨‹æ¨¡å¼ã€‹ <a class="header-anchor" href="#_2-ã€Šæ¸¸æˆç¼–ç¨‹æ¨¡å¼ã€‹" aria-label="Permalink to &quot;2. ã€Šæ¸¸æˆç¼–ç¨‹æ¨¡å¼ã€‹&quot;">â€‹</a></h3><ul><li><strong>ç”¨é€”</strong>: <strong>æ¡†æ¶æ¶æ„å±‚</strong>ã€‚è§£å†³â€œå¦‚ä½•ç»„ç»‡å’Œç®¡ç† UI å†…å®¹â€çš„é—®é¢˜ã€‚</li><li><strong>å­¦ä¹ å†…å®¹</strong>: <ul><li><strong>ç»„ä»¶æ¨¡å¼</strong>: ç”¨äºè®¾è®¡å¯å¤ç”¨ã€å¯ç»„åˆçš„ UI æ§ä»¶ (Widget)ã€‚</li><li><strong>çŠ¶æ€æ¨¡å¼</strong>: ç”¨äºç®¡ç†æ§ä»¶çš„å¤šç§çŠ¶æ€ (å¦‚æŒ‰é’®çš„æ­£å¸¸ã€æ‚¬åœã€æŒ‰ä¸‹)ã€‚</li><li><strong>å‘½ä»¤æ¨¡å¼</strong>: ç”¨äºè§£è€¦ UI äº‹ä»¶å’Œä¸šåŠ¡é€»è¾‘ï¼Œå®ç°æ’¤é”€/é‡åšã€‚</li><li><strong>æ¸¸æˆå¾ªç¯/æ›´æ–°æ–¹æ³•</strong>: ç”¨äºè®¾è®¡é«˜æ•ˆçš„äº‹ä»¶å¾ªç¯å’Œæ¸²æŸ“æ›´æ–°é€»è¾‘ (å¦‚è„æ ‡è®°)ã€‚</li></ul></li><li><strong>é‡è¦æ€§</strong>: <strong>å¿…éœ€</strong>ã€‚è¿™æ˜¯æ„å»ºä¸€ä¸ªå¥å£®ã€å¯ç»´æŠ¤ã€å¯æ‰©å±• GUI æ¡†æ¶çš„æ¶æ„è“å›¾ã€‚</li></ul><h3 id="_3-ã€Šæè‡´cè¯­è¨€ã€‹" tabindex="-1">3. ã€Šæè‡´Cè¯­è¨€ã€‹ <a class="header-anchor" href="#_3-ã€Šæè‡´cè¯­è¨€ã€‹" aria-label="Permalink to &quot;3. ã€Šæè‡´Cè¯­è¨€ã€‹&quot;">â€‹</a></h3><ul><li><strong>è€å¤–å†™çš„ , ä¸­æ–‡ç‰ˆæ˜¯ä¸œå—å¤§å­¦å‡ºç‰ˆç¤¾ , PDD30å—. æŠŠCè¯­è¨€å‘æŒ¥åˆ°æè‡´ , å…¶å®é€‚åˆåµŒå…¥å¼åŒå­¦å¾ˆåº•å±‚</strong></li><li><strong>ç”¨é€”</strong>: <strong>Cè¯­è¨€æ¥å£ å†…å­˜ç®¡ç† é¢å‘å¯¹è±¡ç­‰</strong>ã€‚è§£å†³â€œå¦‚ä½•å®‰å…¨ã€é«˜æ•ˆåœ°åœ¨Swiftä¸­è°ƒç”¨Cåº“â€çš„é—®é¢˜ã€‚</li><li><strong>å­¦ä¹ å†…å®¹</strong>: <ul><li>æ·±å…¥çš„å†…å­˜ç®¡ç†å’ŒæŒ‡é’ˆæ“ä½œã€‚</li></ul></li><li><strong>é‡è¦æ€§</strong>: <strong>å¼ºçƒˆæ¨è</strong>ã€‚å½“éœ€è¦æ‰‹å†™C-Swiftæ¡¥æ¥å±‚ï¼Œå¤„ç†å¤æ‚çš„æ•°æ®ç»“æ„ä¼ é€’å’Œå›è°ƒå‡½æ•°æ—¶ï¼Œè¿™æœ¬ä¹¦çš„çŸ¥è¯†å°†æ˜¯æ— ä»·ä¹‹å®ã€‚</li></ul><h3 id="_4-ã€Šcè¯­è¨€ç¼–ç¨‹é­”æ³•ä¹¦-åŸºäºc11æ ‡å‡†ã€‹" tabindex="-1">4. ã€ŠCè¯­è¨€ç¼–ç¨‹é­”æ³•ä¹¦:åŸºäºC11æ ‡å‡†ã€‹ <a class="header-anchor" href="#_4-ã€Šcè¯­è¨€ç¼–ç¨‹é­”æ³•ä¹¦-åŸºäºc11æ ‡å‡†ã€‹" aria-label="Permalink to &quot;4.  ã€ŠCè¯­è¨€ç¼–ç¨‹é­”æ³•ä¹¦:åŸºäºC11æ ‡å‡†ã€‹&quot;">â€‹</a></h3><ul><li><strong>ç”¨é€”</strong>: <strong>å·©å›ºCè¯­è¨€åŸºç¡€</strong>ã€‚ç¡®ä¿å¯¹ç°ä»£Cè¯­è¨€çš„ç‰¹æ€§æœ‰æ‰å®çš„æŒæ¡ã€‚</li><li><strong>å­¦ä¹ å†…å®¹</strong>: <ul><li>å…¨é¢çš„Cè¯­è¨€è¯­æ³•å’Œæ ‡å‡†åº“çŸ¥è¯†ã€‚</li><li>ç°ä»£Cè¯­è¨€ç‰¹æ€§ï¼ˆå¦‚ <code>_Generic</code>ã€çº¿ç¨‹åº“ç­‰ï¼‰ã€‚</li><li>è‰¯å¥½çš„Cè¯­è¨€ç¼–ç¨‹è§„èŒƒå’Œå®è·µã€‚</li></ul></li><li><strong>é‡è¦æ€§</strong>: <strong>æ¨è</strong>ã€‚ä¸ºæ‚¨é˜…è¯»å’Œç†è§£Win32 API å’Œ Skia C APIï¼Œä»¥åŠç¼–å†™é«˜è´¨é‡çš„æ¡¥æ¥ä»£ç æ‰“ä¸‹åšå®åŸºç¡€ã€‚</li></ul><h3 id="_5-swift-6-1" tabindex="-1">5. Swift 6.1 <a class="header-anchor" href="#_5-swift-6-1" aria-label="Permalink to &quot;5. Swift 6.1&quot;">â€‹</a></h3><ul><li>å®˜ç½‘æ•™ç¨‹ --- gayhub ğŸ™Š æœ‰ä¸­æ–‡ç¿»è¯‘</li></ul><h2 id="å®Œæ•´ç»„ä»¶æ¶æ„å›¾" tabindex="-1">å®Œæ•´ç»„ä»¶æ¶æ„å›¾ <a class="header-anchor" href="#å®Œæ•´ç»„ä»¶æ¶æ„å›¾" aria-label="Permalink to &quot;å®Œæ•´ç»„ä»¶æ¶æ„å›¾&quot;">â€‹</a></h2><p>è¿™å¼ å›¾å±•ç¤ºäº†æ¡†æ¶å†…æ‰€æœ‰æ ¸å¿ƒç»„ä»¶çš„ç›¸äº’å…³ç³»å’Œæ•°æ®æµã€‚</p><p><img src="`+h+`" alt=""></p><h2 id="æ ¸å¿ƒæœºåˆ¶å®ç°-swift" tabindex="-1">æ ¸å¿ƒæœºåˆ¶å®ç° (Swift) <a class="header-anchor" href="#æ ¸å¿ƒæœºåˆ¶å®ç°-swift" aria-label="Permalink to &quot;æ ¸å¿ƒæœºåˆ¶å®ç° (Swift)&quot;">â€‹</a></h2><h3 id="_1-ç±»å‹å®‰å…¨çš„äº‹ä»¶æ€»çº¿-eventbus" tabindex="-1">1. ç±»å‹å®‰å…¨çš„äº‹ä»¶æ€»çº¿ (EventBus) <a class="header-anchor" href="#_1-ç±»å‹å®‰å…¨çš„äº‹ä»¶æ€»çº¿-eventbus" aria-label="Permalink to &quot;1. ç±»å‹å®‰å…¨çš„äº‹ä»¶æ€»çº¿ (EventBus)&quot;">â€‹</a></h3><p>ç”¨äºå¤„ç†ç¦»æ•£çš„ã€è·¨ç»„ä»¶çš„åº”ç”¨çº§äº‹ä»¶ã€‚</p><div class="language-swift vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. ä¸€ä¸ªç©ºçš„åè®®ï¼Œç”¨äºç±»å‹çº¦æŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> protocol</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. å®šä¹‰å…·ä½“çš„äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ButtonClickedEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Event </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buttonId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timestamp: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. å®ç°äº‹ä»¶æ€»çº¿</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventBus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shared </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EventBus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ObjectIdentifier</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Subscription]]()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eventType: E.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> callback: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@escaping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (E) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscription </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Subscription</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: callback)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eventTypeId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ObjectIdentifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventType)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscriptions[eventTypeId] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            subscriptions[eventTypeId] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subscriptions[eventTypeId]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subscription)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event: E) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eventTypeId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ObjectIdentifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: event))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        guard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eventSubscriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscriptions[eventTypeId] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscription </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eventSubscriptions {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> callback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscription.callback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (E) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Subscription</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> callback: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-å“åº”å¼çŠ¶æ€ä¸æ•°æ®ç»‘å®š" tabindex="-1">2. å“åº”å¼çŠ¶æ€ä¸æ•°æ®ç»‘å®š <a class="header-anchor" href="#_2-å“åº”å¼çŠ¶æ€ä¸æ•°æ®ç»‘å®š" aria-label="Permalink to &quot;2. å“åº”å¼çŠ¶æ€ä¸æ•°æ®ç»‘å®š&quot;">â€‹</a></h3><p>ç”¨äºå¤„ç†ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€ç®¡ç†å’Œè§†å›¾è‡ªåŠ¨æ›´æ–°ï¼Œå€Ÿé‰´äº† SwiftUI çš„ <code>@State</code> æ€æƒ³ã€‚</p><div class="language-swift vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. ä¸€ä¸ªç®€å•çš„å‘å¸ƒè€…ï¼Œå½“å€¼æ”¹å˜æ—¶ä¼šå‘é€é€šçŸ¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Publisher</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        didSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            subscribers.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subscribers: [(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initialValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> initialValue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> action: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@escaping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subscribers.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(action)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œç”¨äºåˆå§‹æ¸²æŸ“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. ä½¿ç”¨å±æ€§åŒ…è£…å™¨ï¼Œè®©å®ƒç”¨èµ·æ¥åƒ @State</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@propertyWrapper</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> publisher: Publisher&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wrappedValue: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { publisher.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        nonmutating</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { publisher.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newValue }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> projectedValue: Publisher&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> publisher</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrappedValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.publisher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Publisher</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">initialValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: wrappedValue)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// --- å¦‚ä½•åœ¨ä½ çš„ç»„ä»¶ä¸­ä½¿ç”¨ ---</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyLabelComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å£°æ˜ä¸€ä¸ªå“åº”å¼çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    @State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Initial Text&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è®¢é˜…è¿™ä¸ªçŠ¶æ€çš„å˜åŒ–</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // $text è¯­æ³•å¯ä»¥è®¿é—®åˆ°å†…éƒ¨çš„ Publisher</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $text.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">weak</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] newText </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: newText)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Rendering label with text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\(text)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // åœ¨è¿™é‡Œè°ƒç”¨ Skia API æ¥ç»˜åˆ¶æ–‡æœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="é™„å½•-æ ¸å¿ƒç»„ä»¶çš„å®ç°æ–¹æ¡ˆ" tabindex="-1">é™„å½•ï¼šæ ¸å¿ƒç»„ä»¶çš„å®ç°æ–¹æ¡ˆ <a class="header-anchor" href="#é™„å½•-æ ¸å¿ƒç»„ä»¶çš„å®ç°æ–¹æ¡ˆ" aria-label="Permalink to &quot;é™„å½•ï¼šæ ¸å¿ƒç»„ä»¶çš„å®ç°æ–¹æ¡ˆ&quot;">â€‹</a></h2><p>æœ¬ç« èŠ‚å°†é’ˆå¯¹çª—ä½“ã€DSLã€æ–‡æœ¬å’ŒåŠ¨ç”»ç­‰å…³é”®ç³»ç»Ÿï¼Œæä¾›æ›´ç°ä»£ã€æ›´å…ˆè¿›çš„è®¾è®¡ä¸å®ç°æ–¹æ¡ˆã€‚</p><h3 id="_1-çª—ä½“ç³»ç»Ÿ-å¹³å°æŠ½è±¡å±‚-æ¸²æŸ“è¡¨é¢" tabindex="-1">1. çª—ä½“ç³»ç»Ÿï¼šå¹³å°æŠ½è±¡å±‚ + æ¸²æŸ“è¡¨é¢ <a class="header-anchor" href="#_1-çª—ä½“ç³»ç»Ÿ-å¹³å°æŠ½è±¡å±‚-æ¸²æŸ“è¡¨é¢" aria-label="Permalink to &quot;1. çª—ä½“ç³»ç»Ÿï¼šå¹³å°æŠ½è±¡å±‚ + æ¸²æŸ“è¡¨é¢&quot;">â€‹</a></h3><p>ä¸ºäº†æœªæ¥çš„è·¨å¹³å°å¯èƒ½æ€§ï¼Œå¹¶ä¿æŒæ ¸å¿ƒé€»è¾‘çš„çº¯å‡€ï¼Œçª—ä½“ç³»ç»Ÿåº”è¢«è®¾è®¡ä¸ºä¸¤å±‚ï¼š</p><ul><li><strong>å¹³å°å±‚ (Platform Layer):</strong> ä¸“é—¨è´Ÿè´£ä¸æ“ä½œç³»ç»ŸAPIï¼ˆå¦‚Win32ï¼‰äº¤äº’ï¼Œå¤„ç†çª—å£çš„åˆ›å»ºã€é”€æ¯ã€åŸç”Ÿäº‹ä»¶ï¼ˆé¼ æ ‡ã€é”®ç›˜ã€å°ºå¯¸å˜åŒ–ï¼‰çš„æ¥æ”¶ã€‚å®ƒçš„å”¯ä¸€èŒè´£æ˜¯ç®¡ç†ä¸€ä¸ªåŸç”Ÿçª—å£å¥æŸ„ï¼Œå¹¶å°†äº‹ä»¶è½¬å‘ç»™åº”ç”¨å±‚ã€‚</li><li><strong>åº”ç”¨å±‚ (Application Layer):</strong> å®šä¹‰ä¸€ä¸ªå¹³å°æ— å…³çš„ <code>Window</code> å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æŒæœ‰UIå†…å®¹çš„æ ¹èŠ‚ç‚¹ã€Skiaçš„æ¸²æŸ“è¡¨é¢ï¼ˆ<code>SkSurface</code>ï¼‰ï¼Œå¹¶æ¥æ”¶æ¥è‡ªå¹³å°å±‚çš„æ ‡å‡†åŒ–äº‹ä»¶ã€‚</li></ul><div class="language-swift vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// --- åº”ç”¨å±‚ (å¹³å°æ— å…³) ---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å®šä¹‰ä¸€ä¸ªå¹³å°æ— å…³çš„çª—å£æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">protocol</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NativeWindow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> onEvent: ((NativeEvent) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... å…¶ä»–å¹³å°æ— å…³çš„å±æ€§å’Œæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Window</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nativeWindow: NativeWindow </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¹³å°çª—å£çš„æŠ½è±¡æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> surface: SkSurface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rootWidget: Widget</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (width: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, height: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.nativeWindow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NativeWindowFactory.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: title, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: size)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.nativeWindow.onEvent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.handleNativeEvent</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // self.surface = Skia.createSurface(for: self.nativeWindow)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleNativeEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event: NativeEvent) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å°†åŸç”Ÿäº‹ä»¶è½¬æ¢ä¸ºæ¡†æ¶å†…éƒ¨äº‹ä»¶ï¼Œå¹¶åˆ†å‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // e.g., case .mouseDown(let pos): EventBus.shared.publish(...)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> draw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        guard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> surface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.canvas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        canvas.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(.white)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rootWidget</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">draw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: canvas)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        surface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">flush</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// --- å¹³å°å±‚ (Windows specific) ---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NativeWindow.swift (Windows Implementation)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Win32Window</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NativeWindow </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // let hwnd: HWND</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> onEvent: ((NativeEvent) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... Win32çª—å£åˆ›å»ºå’Œæ¶ˆæ¯å¾ªç¯çš„å®ç° ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åœ¨ WindowProc ä¸­ï¼Œå°† WM_LBUTTONDOWN ç­‰æ¶ˆæ¯è½¬æ¢ä¸º NativeEvent.mouseDown å¹¶è°ƒç”¨ onEvent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-dslè®¾è®¡-resultbuilder-å®ç°å£°æ˜å¼ui" tabindex="-1">2. DSLè®¾è®¡ï¼š@resultBuilder å®ç°å£°æ˜å¼UI <a class="header-anchor" href="#_2-dslè®¾è®¡-resultbuilder-å®ç°å£°æ˜å¼ui" aria-label="Permalink to &quot;2. DSLè®¾è®¡ï¼š@resultBuilder å®ç°å£°æ˜å¼UI&quot;">â€‹</a></h3><p>è¦å®ç°ç±»ä¼¼ SwiftUI çš„ <code>VStack { Text(&quot;Hello&quot;) }</code> è¯­æ³•ï¼Œæœ€ä¼˜é›…çš„æ–¹å¼æ˜¯ä½¿ç”¨ Swift çš„ <code>@resultBuilder</code>ã€‚</p><div class="language-swift vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. å®šä¹‰ Result Builder</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@resultBuilder</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ViewBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> buildBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> components: Widget</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Widget] {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> components</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. å®šä¹‰å®¹å™¨æ§ä»¶ï¼Œå¹¶ä½¿ç”¨ ViewBuilder</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Widget </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> children: [Widget]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ViewBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Widget]) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.children </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // åœ¨è¿™é‡Œå°† children ä¼ é€’ç»™ Yoga å¸ƒå±€å¼•æ“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... draw å’Œ layout å®ç° ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Widget </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... draw å’Œ layout å®ç° ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. ä½¿ç”¨ DSL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myUI </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, Declarative UI!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This is awesome.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    VStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Nested Stack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™ç§æ–¹å¼èƒ½è®©UIä»£ç çš„å±‚çº§ç»“æ„ä¸è§†è§‰å±‚çº§å®Œå…¨å¯¹åº”ï¼Œæå¤§åœ°æé«˜äº†å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="_3-æ–‡æœ¬ç³»ç»Ÿ-æ–‡æœ¬å¡‘å½¢-text-shaping" tabindex="-1">3. æ–‡æœ¬ç³»ç»Ÿï¼šæ–‡æœ¬å¡‘å½¢ (Text Shaping) <a class="header-anchor" href="#_3-æ–‡æœ¬ç³»ç»Ÿ-æ–‡æœ¬å¡‘å½¢-text-shaping" aria-label="Permalink to &quot;3. æ–‡æœ¬ç³»ç»Ÿï¼šæ–‡æœ¬å¡‘å½¢ (Text Shaping)&quot;">â€‹</a></h3><p>è¦æ­£ç¡®æ¸²æŸ“å¤æ‚çš„è„šæœ¬ï¼ˆå¦‚é˜¿æ‹‰ä¼¯è¯­ã€å°åœ°è¯­ï¼‰å¹¶æ”¯æŒè¿å­—ã€å­—å¶é—´è·ç­‰é«˜çº§æ’ç‰ˆç‰¹æ€§ï¼Œå¿…é¡»å¼•å…¥æ–‡æœ¬å¡‘å½¢å¼•æ“ã€‚</p><ul><li><strong>åº“</strong>: HarfBuzz (Googleä¹Ÿåœ¨ç”¨ï¼Œæœ‰C APIï¼Œå¯ä¸Swifté›†æˆ)ã€‚</li><li><strong>æµç¨‹</strong>: <ol><li><strong>è¾“å…¥</strong>: æ–‡æœ¬å­—ç¬¦ä¸²ã€å­—ä½“ (<code>SkTypeface</code>)ã€‚</li><li><strong>HarfBuzzå¤„ç†</strong>: è°ƒç”¨HarfBuzzçš„APIè¿›è¡Œæ–‡æœ¬å¡‘å½¢ï¼Œå®ƒä¼šè¾“å‡ºä¸€ä¸²<code>Glyph</code>ï¼ˆå­—å½¢ï¼‰åˆ—è¡¨ï¼Œæ¯ä¸ª<code>Glyph</code>åŒ…å«IDã€ä½ç½®ï¼ˆx, yåç§»ï¼‰å’Œå‰è¿›å®½åº¦ã€‚</li><li><strong>Skiaæ¸²æŸ“</strong>: å°†å¡‘å½¢åçš„<code>Glyph</code>åˆ—è¡¨ä¼ é€’ç»™Skiaçš„<code>drawGlyphs</code>å‡½æ•°è¿›è¡Œæ¸²æŸ“ã€‚</li></ol></li></ul><p>è¿™ä¸ªæ–¹æ¡ˆå°†å¤æ‚çš„æ–‡æœ¬å¸ƒå±€é€»è¾‘äº¤ç»™äº†ä¸“ä¸šçš„å¼•æ“ï¼Œä½ çš„æ¡†æ¶åªéœ€è¦è´Ÿè´£æœ€ç»ˆçš„ç»˜åˆ¶ã€‚</p><h3 id="_4-åŠ¨ç”»ç³»ç»Ÿ-åŸºäºç‰©ç†çš„å¼¹ç°§æ¨¡å‹" tabindex="-1">4. åŠ¨ç”»ç³»ç»Ÿï¼šåŸºäºç‰©ç†çš„å¼¹ç°§æ¨¡å‹ <a class="header-anchor" href="#_4-åŠ¨ç”»ç³»ç»Ÿ-åŸºäºç‰©ç†çš„å¼¹ç°§æ¨¡å‹" aria-label="Permalink to &quot;4. åŠ¨ç”»ç³»ç»Ÿï¼šåŸºäºç‰©ç†çš„å¼¹ç°§æ¨¡å‹&quot;">â€‹</a></h3><p>ä¸ºäº†å®ç° <code>fluent-react</code> é‚£æ ·è‡ªç„¶ã€å¯ä¸­æ–­çš„åŠ¨ç”»ï¼Œä½¿ç”¨åŸºäºç‰©ç†çš„å¼¹ç°§æ¨¡å‹ï¼Œè€Œä¸æ˜¯ç®€å•çš„çº¿æ€§æ’å€¼ã€‚</p><ul><li><strong>åŸç†</strong>: å°†UIå±æ€§ï¼ˆå¦‚ä½ç½®ã€é€æ˜åº¦ï¼‰çš„å˜åŒ–æ¨¡æ‹Ÿæˆä¸€ä¸ªè¿æ¥åˆ°ç›®æ ‡çš„å¼¹ç°§ã€‚ä½ åªéœ€è¦è®¾ç½®ç›®æ ‡å€¼ï¼ˆ<code>toValue</code>ï¼‰ï¼Œç‰©ç†æ¨¡å‹ä¼šè‡ªåŠ¨è®¡ç®—å‡ºæ¯ä¸€å¸§çš„å½“å‰å€¼ã€‚</li><li><strong>æ ¸å¿ƒå‚æ•°</strong>: å¼¹ç°§çš„ <strong>å¼ åŠ› (tension)</strong> å’Œ <strong>æ‘©æ“¦åŠ› (friction)</strong>ï¼Œé€šè¿‡è°ƒæ•´è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥åˆ›é€ å‡ºå„ç§ä¸åŒçš„åŠ¨ç”»æ•ˆæœã€‚</li></ul><div class="language-swift vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SpringAnimation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentValue: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> targetValue: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> velocity: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tension: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> friction: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tension</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">friction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.currentValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> initial</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.targetValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tension </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tension</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.friction </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> friction</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åœ¨æ¯ä¸€å¸§çš„æ›´æ–°å¾ªç¯ä¸­è°ƒç”¨æ­¤æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deltaTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> springForce </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (targetValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentValue) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tension</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> frictionForce </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> velocity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> friction</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> acceleration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> springForce </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> frictionForce</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        velocity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> acceleration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deltaTime</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        currentValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> velocity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deltaTime</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// let spring = SpringAnimation(initial: 0, target: 100, tension: 30, friction: 5)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// myWidget.onUpdate = { dt in </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     spring.update(deltaTime: dt)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     myWidget.x = spring.currentValue</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// }</span></span></code></pre></div><hr>`,44)]))}const c=i(k,[["render",t]]);export{y as __pageData,c as default};
